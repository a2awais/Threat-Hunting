DeviceProcessEvents
| where FileName =~ "cmd.exe"
| where InitiatingProcessFileName in~ (
    "powershell.exe",
    "pwsh.exe",
    "wscript.exe",
    "cscript.exe",
    "mshta.exe",
    "winword.exe",
    "excel.exe",
    "outlook.exe",
    "msiexec.exe"
)
| where ProcessCommandLine has_all (
    "curl",
    "-s",
    "-o",
    ".pdf",
    "del /s /q"
)
| where ProcessCommandLine has_any (
    "Users\\Public",
    "conhost.exe",
    "--headless"
)
| project
    Timestamp,
    DeviceName,
    AccountName,
    ProcessCommandLine,
    InitiatingProcessFileName,
    InitiatingProcessCommandLine

